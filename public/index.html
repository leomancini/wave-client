<!DOCTYPE html>
<html lang="en" style="background-color: #ffffff !important">
  <head>
    <style>
      :root {
        background-color: #ffffff !important;
      }

      html,
      body,
      #root {
        background-color: #ffffff !important;
      }

      @media (display-mode: standalone) {
        :root,
        html,
        body,
        #root {
          background-color: #ffffff !important;
        }
      }
    </style>
    <meta charset="utf-8" />
    <script>
      // Immediately set up the manifest based on URL
      (function () {
        const path = window.location.pathname.split("/");
        const manifest = {
          display: "standalone",
          background_color: "#ffffff",
          theme_color: "#ffffff",
          orientation: "portrait",
          icons: [
            {
              src: window.location.origin + "/images/app-icons/180.png",
              sizes: "180x180",
              type: "image/png"
            },
            {
              src: window.location.origin + "/images/app-icons/167.png",
              sizes: "167x167",
              type: "image/png"
            },
            {
              src: window.location.origin + "/images/app-icons/152.png",
              sizes: "152x152",
              type: "image/png"
            },
            {
              src: window.location.origin + "/images/app-icons/192.png",
              sizes: "192x192",
              type: "image/png"
            },
            {
              src: window.location.origin + "/images/app-icons/512.png",
              sizes: "512x512",
              type: "image/png"
            }
          ],
          screenshots: [
            {
              src: window.location.origin + "/images/screenshots/mobile.png",
              sizes: "1170x2532",
              type: "image/png",
              platform: "narrow",
              label: "Screenshot"
            }
          ]
        };

        if (path.length >= 3 && path[1] && path[2]) {
          // We have a valid groupId and userId
          const groupId = path[1];
          const userId = path[2];
          manifest.name = groupId;
          manifest.id = groupId;
          manifest.short_name = groupId;
          manifest.start_url =
            window.location.origin +
            "/" +
            groupId +
            "/" +
            userId +
            "?source=pwa";
        } else {
          // Default manifest for the root
          manifest.name = "WAVE";
          manifest.id = "WAVE";
          manifest.short_name = "WAVE";
          manifest.start_url = window.location.origin + "/";
        }

        const blob = new Blob([JSON.stringify(manifest)], {
          type: "application/manifest+json"
        });
        const manifestUrl = URL.createObjectURL(blob);
        const link = document.createElement("link");
        link.rel = "manifest";
        link.href = manifestUrl;
        document.head.appendChild(link);
      })();
    </script>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"
    />
    <meta name="HandheldFriendly" content="true" />
    <meta name="format-detection" content="telephone=no" />
    <script>
      document.addEventListener("gesturestart", function (e) {
        e.preventDefault();
      });
      document.addEventListener("gesturechange", function (e) {
        e.preventDefault();
      });
      document.addEventListener("gestureend", function (e) {
        e.preventDefault();
      });
    </script>
    <title>WAVE</title>
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŒŠ</text></svg>"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="/images/app-icons/192.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="512x512"
      href="/images/app-icons/512.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/images/app-icons/180.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="152x152"
      href="/images/app-icons/152.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="167x167"
      href="/images/app-icons/167.png"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="white" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta
      name="theme-color"
      content="#ffffff"
      media="(prefers-color-scheme: light)"
    />
    <meta
      name="theme-color"
      content="#ffffff"
      media="(prefers-color-scheme: dark)"
    />
    <meta name="theme-color" content="#ffffff" />
    <meta name="background-color" content="#ffffff" />
  </head>
  <body style="background-color: #ffffff !important">
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root" style="background-color: #ffffff !important"></div>
    <script>
      // Auto-reload if the main JS bundle fails to load (stale cached index.html)
      window.addEventListener("error", function (e) {
        if (e.target && e.target.tagName === "SCRIPT" && e.target.src && e.target.src.includes("/static/js/main.")) {
          var reloaded = sessionStorage.getItem("__wave_reloaded");
          if (!reloaded) {
            sessionStorage.setItem("__wave_reloaded", "1");
            window.location.reload();
          }
        }
      }, true);
    </script>
  </body>
</html>
